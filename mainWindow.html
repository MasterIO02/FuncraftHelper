<!DOCTYPE html>
<html lang="fr">

<head>
    <title> FuncraftHelper </title>
    <link rel="stylesheet" href="style.css">
    <script type="text/javascript" src="checkGame.js"></script>
</head>

<body>
    <div class="dragHitbox"></div>
    </div>

    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300&display=swap" rel="stylesheet">


    <span class="buttons" style="position: fixed; right: 10px; top: 10px">
        <button id="settings-btn">p</button>
        <button id="min-btn">-</button>
        <button id="close-btn">x</button>
    </span>

    <div id="mainObjects" class="mainObjects" style="visibility: visible;">
        <h4 style="position: fixed; top: -10px; left: 10px;" class="title"> FuncraftHelper 2.1.1 </h4>
        <textarea id="mainTextArea" rows='21' cols='71' style="resize: none; position: fixed; left: 5px; top: 50px"
            disabled="disabled">
        </textarea>
    </div>


    <div id="settingsObjects" class="settingsObjects" style="visibility: hidden;">
        <h4 style="position: fixed; top: -10px; left: 10px" class="title"> FuncraftHelper 2.1.1 - Paramètres</h4>

        <label style="position: fixed; top: 40px; left: 40px" class="switch">
            <input type="checkbox" id="useMorgothAPISwitch">
            <div>
                <p style="position:relative; right: -100px"> Utiliser l'API de LordMorgoth </p>
                <span></span>
            </div>
        </label>

        <textarea spellcheck="false" hidden name="MorgothAPIKeyTextArea" id="MorgothAPIKeyTextArea" rows="1" cols="15"
            style="-webkit-text-security: disc ; font-family:Arial, Helvetica, sans-serif ; resize: none; position: fixed; top: 55px; left: 420px"></textarea>
        <p hidden id="APIKeyText" style="position:fixed; top: 65px; left: 437px; user-select: none;"> Votre clé d'API
        </p>

        <label style="position: fixed; top: 95px; left: 40px;" class="switch">
            <input type="checkbox" id="headlessSwitch">
            <div>
                <p style="position:fixed; left: 140px; top: 80px"> Mode headless </p>
                <span></span>
            </div>
        </label>

        <textarea spellcheck="false" name="usernameTextArea" id="usernameTextArea" rows="1" cols="10"
            style="font-family:Arial, Helvetica, sans-serif; resize: none; position: fixed; top: 135px; left: 20px;"></textarea>
        <p style="position:fixed; left:140px; top:120px; user-select: none;"> Pseudo in-game </p>

        <textarea spellcheck="false" name="logFileLocationTextArea" id="logFileLocationTextArea" rows="1" cols="60"
            style="font-family:Arial, Helvetica, sans-serif; resize: none; position: fixed; top: 350px; left: 45px"></textarea>
        <p style="position:fixed; left: 140px; top: 300px; user-select: none;"> Emplacement du latest.log de Minecraft
        </p>

        <textarea spellcheck="false" name="chromeLocationTextArea" id="chromeLocationTextArea" rows="1" cols="60"
            style="font-family:Arial, Helvetica, sans-serif; resize: none; position: fixed; top: 280px; left: 45px"></textarea>
        <p style="position:fixed; left: 140px; top: 230px; user-select: none;"> Emplacement de Chrome ou Chromium </p>

        <p style="position:fixed; left: 10px; top: 365px; user-select: none; font-size: small; font-style: oblique;">
            Système : </p>
        <p id="systemType"
            style="position:fixed; left: 70px; top: 365px; user-select: none; font-size: small; font-style: oblique;">
            Inconnu </p>

        <div class="help-tip" style="position: fixed; top: 99px; left: 255px">
            <p>Si cette option est désactivée, la vérification des statistiques sera faite en étant visible. Par défaut
                activée donc invisible.</p>
        </div>
    </div>
</body>


<script>
    // Initialisation GUI
    function initGUI() {
        const { BrowserWindow } = require('electron').remote
        const Store = require('electron-store');
        const store = new Store();

        // Actions boutons
        document.getElementById("min-btn").addEventListener("click", (e) => {
            var window = BrowserWindow.getFocusedWindow();
            window.minimize();
        })
        document.getElementById("close-btn").addEventListener("click", (e) => {
            var window = BrowserWindow.getFocusedWindow();
            window.close();
        })
        document.getElementById("settings-btn").addEventListener("click", (e) => {
            if (document.getElementById("settingsObjects").style.visibility == "hidden") {
                document.getElementById("settingsObjects").style.visibility = "visible"
                document.getElementById("mainObjects").style.visibility = "hidden"
            } else {
                document.getElementById("mainObjects").style.visibility = "visible"
                document.getElementById("settingsObjects").style.visibility = "hidden"
            }
        })

        // Initialisation du system type
        document.getElementById("systemType").innerHTML = store.get('systemType')

        // Script pour switch MorgothAPI
        if (store.get('useMorgothAPI') == true) {
            document.getElementById("useMorgothAPISwitch").checked = true
            document.getElementById("APIKeyText").hidden = false
            document.getElementById("MorgothAPIKeyTextArea").hidden = false

        } else {
            document.getElementById("useMorgothAPISwitch").checked = false
        }

        document.getElementById("useMorgothAPISwitch").addEventListener("click", (e) => {
            if (store.get('useMorgothAPI') == true) {
                store.set('useMorgothAPI', false)
                document.getElementById("APIKeyText").hidden = true
                document.getElementById("MorgothAPIKeyTextArea").hidden = true

            } else {
                store.set('useMorgothAPI', true)
                document.getElementById("APIKeyText").hidden = false
                document.getElementById("MorgothAPIKeyTextArea").hidden = false

            }
        })

        // Script pour switch headless
        if (store.get('headless') == true) {
            document.getElementById("headlessSwitch").checked = true
        } else {
            document.getElementById("headlessSwitch").checked = false
        }

        document.getElementById("headlessSwitch").addEventListener("click", (e) => {
            if (store.get('headless') == true) {
                store.set('headless', false)
            } else {
                store.set('headless', true)
            }
        })

        // Script pour textarea username
        document.getElementById("usernameTextArea").value = store.get('username')
        document.getElementById("usernameTextArea").addEventListener("input", (e) => {
            store.set('username', document.getElementById('usernameTextArea').value)
        })

        // Script pour textarea morgothAPIkey
        document.getElementById("MorgothAPIKeyTextArea").value = store.get('MorgothAPIKey')
        document.getElementById("MorgothAPIKeyTextArea").addEventListener("input", (e) => {
            store.set('MorgothAPIKey', document.getElementById('MorgothAPIKeyTextArea').value)
        })

        // Script pour emplacement latest.log
        document.getElementById("logFileLocationTextArea").value = store.get('logFileLocation')
        document.getElementById("logFileLocationTextArea").addEventListener("input", (e) => {
            store.set('logFileLocation', document.getElementById('logFileLocationTextArea').value)
        })

        // Script pour emplacement chrome
        document.getElementById("chromeLocationTextArea").value = store.get('chromeLocation')
        document.getElementById("chromeLocationTextArea").addEventListener("input", (e) => {
            store.set('chromeLocation', document.getElementById('chromeLocationTextArea').value)
        })

        document.getElementById("mainTextArea").value = '           - https://github.com/MasterIO02/FuncraftHelper -\n';
        document.getElementById("mainTextArea").value += "      - Faites moi part de vos suggestions / bugs sur GitHub ! -\n\n"

    }
    initGUI()

    // Check si une mise à jour est disponible
    const fetch = require("node-fetch");
    fetch("https://api.github.com/repos/MasterIO02/FuncraftHelper/releases/latest")
        .then(res => res.json())
        .then((json) => {
            if (json.tag_name != "2.1.1") {
                document.getElementById("mainTextArea").value += "\nLa version " + json.tag_name + " de FuncraftHelper est disponible !\n";
                document.getElementById("mainTextArea").value += "Téléchargez-la pour disposer de corrections de bugs, optis, et nouvelles fonctionnalités !\n";
                document.getElementById("mainTextArea").value += "https://github.com/MasterIO02/FuncraftHelper/releases\n\n";
            }
        })


    // Check si c'est la première fois que FH est lancé
    if (store.get('firstLaunch') == undefined) {
        document.getElementById("mainTextArea").value += "Il s'agit visiblement de la première fois que FuncraftHelper est lancé. Modifiez les paramètres puis relancez le programme !\n";
        store.set('firstLaunch', false)
    } else {
        if (store.get('systemType') == "darwin") {
            document.getElementById("mainTextArea").value += "MacOS n'est pas officiellement supporté par FuncraftHelper. Merci de ne pas faire de rapport de bugs pour ce système.\n\n";
        } else if (store.get('systemType') == "win32") {
            document.getElementById("mainTextArea").value += "Windows détecté. Lancez le programme en administrateur pour de bien meilleures performances.\n\n"
        }
        const checkGamemode = require('./checkGame').checkGamemode
        checkGamemode()
    }

</script>

</html>